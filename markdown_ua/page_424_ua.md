#### 12.2.2.2 Скетч Count-Min

Хоча фільтр Блума ефективний для запитів на перевірку членства, він не призначений для методів, які вимагають *підсумків на основі підрахунку*. Це тому, що фільтр Блума відстежує лише бінарні значення. Скетч count-min призначений для вирішення таких запитів і інтуїтивно пов'язаний з фільтром Блума. Скетч count-min складається з набору $w$ різних *числових масивів*, кожен з яких має довжину $m$. Таким чином, вимога до пам'яті для скетчу count-min дорівнює $m \cdot w$ комірок, що містять числові значення. Елементи кожного з $w$ числових масивів індексуються, починаючи з 0, що відповідає діапазону індексів $\{0...m - 1\}$. Скетч count-min також можна розглядати як $w \times m$-вимірний масив комірок.

Кожен з $w$ числових масивів відповідає хеш-функції. $i$-й числовий масив відповідає $i$-й хеш-функції $h_i(\cdot)$. Хеш-функції мають такі властивості:

1. $i$-та хеш-функція $h_i(\cdot)$ відображає елемент потоку на ціле число в діапазоні $[0...m - 1]$. Це відображення також можна розглядати як одне із значень індексу в $i$-му числовому масиві.

2. $w$ хеш-функцій $h_1(\cdot)...h_w(\cdot)$ повністю незалежні одна від одної, але *попарно незалежні* для різних аргументів. Іншими словами, для будь-яких двох значень $x_1$ та $x_2$, $h_i(x_1)$ та $h_i(x_2)$ є незалежними.

Вимога *попарної незалежності* є слабшою, ніж вимога повної незалежності. Це зручна властивість скетчу count-min, оскільки зазвичай легше побудувати попарно незалежні хеш-функції, ніж повністю незалежні.

Процедура оновлення скетчу виглядає так. Всі $m \cdot w$ записів у скетчі count-min ініціалізуються нулями. Для кожного вхідного елемента потоку $x$ до нього застосовуються функції $h_1(x)...h_w(x)$. Для $i$-го масиву елемент $h_i(x)$ збільшується на 1. Таким чином, якщо скетч count-min $\text{CM}$ візуалізувати як 2-вимірний $w \times m$ числовий масив, то елемент $(i, h_i(x))$ збільшується на 1. Зверніть увагу, що значення $h_i(x)$ відображається на ціле число в діапазоні $[0, m - 1]$. Це також діапазон індексів кожного числового масиву. Ілюстрація скетчу count-min та відповідного процесу оновлення наведена на Рис. 12.4. Псевдокод для загального процесу оновлення проілюстровано на Рис. 12.5. У псевдокоді потік позначається як $S$, а структура даних скетчу count-min позначається як $\text{CM}$. Вхідними даними для алгоритму є потік $S$ та два параметри $(w, m)$, що визначають розмір 2-вимірного масиву для скетчу count-min. 2-вимірний масив $\text{CM}$ розміром $w \times m$ ініціалізується з усіма значеннями, встановленими на 0. Для кожного вхідного елемента потоку підраховуються всі
[ілюстрація, сторінка 403]