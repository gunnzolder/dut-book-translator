Щоб прийняти це рішення, використовується векторна ознака кластера $M_p$ для визначення, чи потрапляє ця точка даних у максимальну межу мікрокластера $M_p$. Якщо так, то точка даних $X_i$ додається до мікрокластера $M_p$ з використанням властивості адитивності мікрокластерів. Максимальна межа мікрокластера $M_p$ визначається як фактор $t$ середньоквадратичного відхилення точок даних у $M_p$ від центроїда. Значення $t$ є параметром, визначеним користувачем, і зазвичай встановлюється на 3.

Якщо точка даних не лежить у межах максимальної межі найближчого мікрокластера, то необхідно створити новий мікрокластер, що містить точку даних $X_i$. Однак, щоб створити цей новий мікрокластер, кількість інших мікрокластерів повинна бути зменшена на 1, щоб звільнити доступну пам'ять. Це можна досягти шляхом видалення старого мікрокластера або об'єднання двох старих кластерів. Це рішення приймається шляхом перевірки застарілості різних кластерів та кількості точок у них. Статистика часових міток мікрокластерів перевіряється для визначення, чи один із них є "достатньо" застарілим, щоб заслуговувати на видалення. Якщо це не так, то ініціюється об'єднання двох мікрокластерів.

Як визначається застарілість мікрокластера? Мікрокластери використовуються для апроксимації середнього часу останніх $m$ точок даних кластера $M$. Це значення не відоме явно, оскільки останні $m$ точок даних не зберігаються явно, щоб мінімізувати вимоги до пам'яті. Середнє значення $\mu$ та дисперсія $\sigma^2$ часових міток у мікрокластері можуть бути використані разом із припущенням нормального розподілу розподілу часових міток для оцінки цього значення. Таким чином, якщо кластер містить $m_0 > m$ точок даних, то $m/(2 \cdot m_0)$-й процентиль нормального розподілу з середнім $\mu$ та дисперсією $\sigma^2$ може бути використаний як оцінка. Це значення називається відповідною міткою часу кластера $M$. Зверніть увагу, що $\mu$ та $\sigma^2$ можуть бути обчислені з часових компонентів векторів ознак кластера. Коли найменша така відповідна мітка часу будь-якого мікрокластера опускається нижче порогового значення $\delta$, визначеного користувачем, його можна видалити. У випадках, коли жоден мікрокластер не може бути безпечно видалений, найближчі мікрокластери об'єднуються. Операція об'єднання може бути ефективно виконана завдяки існуванню вектора ознак кластера. Відстані між мікрокластерами можна легко обчислити за допомогою вектора ознак кластера. Коли два мікрокластери об'єднуються, їхня статистика додається разом завдяки властивості адитивності мікрокластерів.

## 12.4.2.3 Пірамідальна часова рамка

Статистика мікрокластерів періодично зберігається для забезпечення аналізу кластерів, специфічного для горизонту. Це обслуговування виконується під час фази мікрокластеризації. У цьому підході знімки мікрокластерів зберігаються з різним рівнем деталізації залежно від актуальності знімка. Знімки класифікуються за різними порядками, які можуть варіюватися від 1 до $\log(T)$, де $T$ - час, що минув з початку потоку. Порядок знімка регулює рівень часової деталізації, на якому він зберігається, відповідно до наступних правил:

- Знімки $i$-го порядку зберігаються з інтервалами часу $\alpha^i$, де $\alpha$ - ціле число, і $\alpha \geq 1$. Зокрема, кожен знімок $i$-го порядку зберігається, коли значення годинника ділиться рівно на $\alpha^i$.

- У будь-який заданий момент часу зберігаються лише останні $\alpha^l + 1$ знімків порядку $i$.

Наведене вище визначення дозволяє значну надмірність у зберіганні знімків. Наприклад, час годинника 8 ділиться на $2^0, 2^1, 2^2$ та $2^3$ (де $\alpha = 2$). Отже, стан мікрокластерів у момент часу годинника 8 одночасно відповідає знімкам порядку 0, порядку 1, порядку 2 та порядку 3. З точки зору реалізації знімок потрібно підтримувати лише один раз.